FROM node:22-bookworm

WORKDIR /app

# Copy everything
COPY . .

# Enable corepack for pnpm
RUN corepack enable

# Install dependencies only (skip build)
RUN pnpm install --no-frozen-lockfile --prod=false

ENV NODE_ENV=production

# Railway provides PORT env variable
EXPOSE ${PORT:-8080}

# Run directly from source using tsx (no build needed)
CMD ["sh", "-c", "node --import tsx openclaw.mjs gateway --allow-unconfigured --bind lan --port ${PORT:-8080}"]
